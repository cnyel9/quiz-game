&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;link
      rel=&quot;icon&quot;
      href=&quot;data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;ðŸŽ²&lt;/text&gt;&lt;/svg&gt;&quot;
    /&gt;
    &lt;title&gt;Profil - Seru Tapi Miskin&lt;/title&gt;
    &lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body
    class=&quot;bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 min-h-screen&quot;
  &gt;
    &lt;!-- Navbar --&gt;
    &lt;nav
      class=&quot;fixed top-0 left-0 right-0 z-50 bg-white/20 backdrop-blur-md shadow-lg&quot;
    &gt;
      &lt;div
        class=&quot;container mx-auto px-4 py-3 flex justify-between items-center&quot;
      &gt;
        &lt;div class=&quot;flex items-center space-x-4&quot;&gt;
          &lt;a
            href=&quot;index.html&quot;
            class=&quot;text-2xl font-bold text-white drop-shadow-lg hover:text-purple-200 transition-colors duration-300&quot;
          &gt;
            Seru Tapi Miskin
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;div class=&quot;flex items-center space-x-6&quot;&gt;
          &lt;div class=&quot;hidden md:flex space-x-4&quot;&gt;
            &lt;a
              href=&quot;quiz.html&quot;
              class=&quot;text-white hover:text-purple-200 transition-colors duration-300 flex items-center space-x-2&quot;
            &gt;
              &lt;svg
                xmlns=&quot;http://www.w3.org/2000/svg&quot;
                class=&quot;h-5 w-5&quot;
                fill=&quot;none&quot;
                viewBox=&quot;0 0 24 24&quot;
                stroke=&quot;currentColor&quot;
              &gt;
                &lt;path
                  strokeLinecap=&quot;round&quot;
                  strokeLinejoin=&quot;round&quot;
                  strokeWidth=&quot;{2}&quot;
                  d=&quot;M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z&quot;
                /&gt;
              &lt;/svg&gt;
              &lt;span&gt;Quiz&lt;/span&gt;
            &lt;/a&gt;
            &lt;a
              href=&quot;leaderboard.html&quot;
              class=&quot;text-white hover:text-purple-200 transition-colors duration-300 flex items-center space-x-2&quot;
            &gt;
              &lt;svg
                xmlns=&quot;http://www.w3.org/2000/svg&quot;
                class=&quot;h-5 w-5&quot;
                fill=&quot;none&quot;
                viewBox=&quot;0 0 24 24&quot;
                stroke=&quot;currentColor&quot;
              &gt;
                &lt;path
                  strokeLinecap=&quot;round&quot;
                  strokeLinejoin=&quot;round&quot;
                  strokeWidth=&quot;{2}&quot;
                  d=&quot;M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z&quot;
                /&gt;
              &lt;/svg&gt;
              &lt;span&gt;Peringkat&lt;/span&gt;
            &lt;/a&gt;
          &lt;/div&gt;

          &lt;div class=&quot;flex items-center space-x-4&quot;&gt;
            &lt;a
              href=&quot;profile.html&quot;
              class=&quot;text-white hover:text-purple-200 transition-all duration-300 transform hover:scale-110&quot;
            &gt;
              &lt;svg
                xmlns=&quot;http://www.w3.org/2000/svg&quot;
                class=&quot;h-6 w-6&quot;
                fill=&quot;none&quot;
                viewBox=&quot;0 0 24 24&quot;
                stroke=&quot;currentColor&quot;
              &gt;
                &lt;path
                  strokeLinecap=&quot;round&quot;
                  strokeLinejoin=&quot;round&quot;
                  strokeWidth=&quot;{2}&quot;
                  d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot;
                /&gt;
              &lt;/svg&gt;
            &lt;/a&gt;
            &lt;button
              onclick=&quot;logout()&quot;
              class=&quot;text-white hover:text-red-300 transition-all duration-300 transform hover:scale-110&quot;
            &gt;
              &lt;svg
                xmlns=&quot;http://www.w3.org/2000/svg&quot;
                class=&quot;h-6 w-6&quot;
                fill=&quot;none&quot;
                viewBox=&quot;0 0 24 24&quot;
                stroke=&quot;currentColor&quot;
              &gt;
                &lt;path
                  strokeLinecap=&quot;round&quot;
                  strokeLinejoin=&quot;round&quot;
                  strokeWidth=&quot;{2}&quot;
                  d=&quot;M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1&quot;
                /&gt;
              &lt;/svg&gt;
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/nav&gt;

    &lt;div class=&quot;pt-20 container mx-auto px-4 py-8&quot;&gt;
      &lt;div class=&quot;bg-white rounded-xl shadow-lg p-6&quot;&gt;
        &lt;div class=&quot;mb-6 flex flex-col items-center&quot;&gt;
          &lt;div
            class=&quot;w-32 h-32 rounded-full border-4 border-purple-300 mb-4 overflow-hidden&quot;
          &gt;
            &lt;img
              id=&quot;profile-image&quot;
              src=&quot;&quot;
              alt=&quot;Foto Profil&quot;
              class=&quot;w-full h-full object-cover&quot;
            /&gt;
          &lt;/div&gt;
          &lt;input
            type=&quot;file&quot;
            id=&quot;profile-image-upload&quot;
            accept=&quot;image/*&quot;
            class=&quot;hidden&quot;
          /&gt;
          &lt;button
            onclick=&quot;document.getElementById(&#39;profile-image-upload&#39;).click()&quot;
            class=&quot;bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600&quot;
          &gt;
            Unggah Foto
          &lt;/button&gt;
        &lt;/div&gt;
        &lt;h1 class=&quot;text-2xl font-bold mb-4 text-purple-600&quot;&gt;Profil Akun&lt;/h1&gt;

        &lt;div class=&quot;mb-4&quot;&gt;
          &lt;label class=&quot;block text-gray-700&quot;&gt;Username&lt;/label&gt;
          &lt;input
            type=&quot;text&quot;
            id=&quot;username-display&quot;
            class=&quot;w-full p-2 border rounded&quot;
            readonly
          /&gt;
        &lt;/div&gt;

        &lt;div class=&quot;space-y-4&quot;&gt;
          &lt;button
            onclick=&quot;exportProfile()&quot;
            class=&quot;w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600&quot;
          &gt;
            Export Profil
          &lt;/button&gt;

          &lt;label class=&quot;block&quot;&gt;
            &lt;span class=&quot;text-gray-700&quot;&gt;Import Profil&lt;/span&gt;
            &lt;input
              type=&quot;file&quot;
              id=&quot;import-profile&quot;
              accept=&quot;.json&quot;
              class=&quot;block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100&quot;
            /&gt;
          &lt;/label&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
      // Fungsi kompresi gambar
      async function compressImage(dataUrl, maxWidth = 300, maxHeight = 300) {
        return new Promise((resolve) =&gt; {
          const img = new Image();
          img.onload = () =&gt; {
            const canvas = document.createElement(&quot;canvas&quot;);
            let width = img.width;
            let height = img.height;

            // Sesuaikan ukuran
            if (width &gt; height) {
              if (width &gt; maxWidth) {
                height *= maxWidth / width;
                width = maxWidth;
              }
            } else {
              if (height &gt; maxHeight) {
                width *= maxHeight / height;
                height = maxHeight;
              }
            }

            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext(&quot;2d&quot;);
            ctx.drawImage(img, 0, 0, width, height);

            resolve(canvas.toDataURL(&quot;image/jpeg&quot;, 0.7));
          };
          img.src = dataUrl;
        });
      }

      // Untuk logout
      function logout() {
        localforage.removeItem(&quot;username&quot;).then(() =&gt; {
          window.location.href = &quot;index.html&quot;;
        });
      }

      // Fungsi untuk menyimpan skor
      async function saveScore(name, score) {
        try {
          let leaderboard = (await localforage.getItem(&quot;leaderboard&quot;)) || [];

          // Ambil foto profil
          const profileImage = await localforage.getItem(&quot;profileImage&quot;);

          // Tambahkan skor baru
          leaderboard.push({
            name: name || &quot;Pemain Misterius&quot;,
            score: score,
            totalScore: (await localforage.getItem(&quot;totalScore&quot;)) || score,
            date: new Date().toLocaleDateString(),
            profileImage:
              profileImage || &quot;https://via.placeholder.com/50?text=Profil&quot;,
          });

          // Urutkan dari skor tertinggi
          leaderboard.sort((a, b) =&gt; b.totalScore - a.totalScore);

          // Batasi 10 skor teratas
          leaderboard = leaderboard.slice(0, 10);

          // Simpan kembali
          await localforage.setItem(&quot;leaderboard&quot;, leaderboard);
        } catch (error) {
          console.error(&quot;Gagal menyimpan skor&quot;, error);
        }
      }

      // Fungsi untuk menampilkan leaderboard
      async function displayLeaderboard() {
        const leaderboardContainer = document.getElementById(
          &quot;leaderboard-container&quot;
        );

        try {
          const leaderboard = (await localforage.getItem(&quot;leaderboard&quot;)) || [];

          if (leaderboard.length === 0) {
            leaderboardContainer.innerHTML = `
                      &lt;div class=&quot;text-center text-gray-600&quot;&gt;
                          Belum ada peringkat. Ayo main pertama!
                      &lt;/div&gt;
                  `;
            return;
          }

          const leaderboardHTML = leaderboard
            .map(
              (entry, index) =&gt; `
                      &lt;div class=&quot;flex justify-between items-center bg-purple-100 p-4 rounded-lg&quot;&gt;
                          &lt;div class=&quot;flex items-center space-x-4&quot;&gt;
                              &lt;span class=&quot;font-bold text-purple-600&quot;&gt;#${
                                index + 1
                              }&lt;/span&gt;
                              &lt;div class=&quot;flex items-center space-x-4&quot;&gt;
                                  &lt;img
                                      src=&quot;${
                                        entry.profileImage ||
                                        &quot;https://via.placeholder.com/50?text=Profil&quot;
                                      }&quot;
                                      alt=&quot;Foto Profil&quot;
                                      class=&quot;w-12 h-12 rounded-full object-cover&quot;
                                  /&gt;
                                  &lt;span&gt;${entry.name}&lt;/span&gt;
                              &lt;/div&gt;
                          &lt;/div&gt;
                          &lt;div class=&quot;flex items-center space-x-2&quot;&gt;
                              &lt;span class=&quot;text-green-600 font-semibold&quot;&gt;Total Skor: ${
                                entry.totalScore
                              }&lt;/span&gt;
                              &lt;span class=&quot;text-gray-500 text-sm&quot;&gt;${
                                entry.date
                              }&lt;/span&gt;
                          &lt;/div&gt;
                      &lt;/div&gt;
                  `
            )
            .join(&quot;&quot;);

          leaderboardContainer.innerHTML = leaderboardHTML;
        } catch (error) {
          console.error(&quot;Gagal memuat leaderboard&quot;, error);
        }
      }

      // Muat leaderboard saat halaman dibuka
      displayLeaderboard();

      // Tambahan untuk upload foto profil (jika di halaman profil)
      if (document.getElementById(&quot;profile-image-upload&quot;)) {
        document
          .getElementById(&quot;profile-image-upload&quot;)
          .addEventListener(&quot;change&quot;, async (event) =&gt; {
            const file = event.target.files[0];
            if (!file) return;

            // Validasi tipe file
            if (!file.type.startsWith(&quot;image/&quot;)) {
              alert(&quot;Harap pilih file gambar&quot;);
              return;
            }

            // Batasi ukuran file (misalnya 5MB)
            if (file.size &gt; 5 * 1024 * 1024) {
              alert(&quot;Ukuran file terlalu besar. Maksimal 5MB&quot;);
              return;
            }

            // Baca file sebagai Data URL
            const reader = new FileReader();
            reader.onload = async (e) =&gt; {
              const profileImage = document.getElementById(&quot;profile-image&quot;);

              try {
                // Kompres gambar
                const compressedImage = await compressImage(e.target.result);

                // Tampilkan gambar
                profileImage.src = compressedImage;

                // Simpan foto ke local storage
                await localforage.setItem(&quot;profileImage&quot;, compressedImage);

                // Ambil username pengguna saat ini
                const currentUsername = await localforage.getItem(&quot;username&quot;);

                // Update leaderboard hanya untuk username yang sesuai
                let leaderboard =
                  (await localforage.getItem(&quot;leaderboard&quot;)) || [];
                leaderboard = leaderboard.map((entry) =&gt;
                  entry.name === currentUsername
                    ? { ...entry, profileImage: compressedImage }
                    : entry
                );

                await localforage.setItem(&quot;leaderboard&quot;, leaderboard);

                // Refresh leaderboard
                displayLeaderboard();
              } catch (error) {
                console.error(&quot;Gagal menyimpan foto profil&quot;, error);
                alert(&quot;Gagal menyimpan foto profil&quot;);
              }
            };
            reader.readAsDataURL(file);
          });
      }

      // Muat foto profil saat halaman dimuat
      document.addEventListener(&quot;DOMContentLoaded&quot;, async () =&gt; {
        const profileImage = document.getElementById(&quot;profile-image&quot;);
        const savedProfileImage = await localforage.getItem(&quot;profileImage&quot;);

        if (savedProfileImage) {
          profileImage.src = savedProfileImage;
        } else {
          // Foto default jika tidak ada
          profileImage.src = &quot;https://via.placeholder.com/150?text=Profil&quot;;
        }

        // Tampilkan username
        const username = await localforage.getItem(&quot;username&quot;);
        document.getElementById(&quot;username-display&quot;).value =
          username || &quot;Pengguna&quot;;
      });

      // Fungsi Export Profil
      async function exportProfile() {
        try {
          // Ambil data yang ingin di-export
          const profileData = {
            username: await localforage.getItem(&quot;username&quot;),
            leaderboard: (await localforage.getItem(&quot;leaderboard&quot;)) || [],
            profileImage: (await localforage.getItem(&quot;profileImage&quot;)) || null,
          };

          // Buat file JSON
          const blob = new Blob([JSON.stringify(profileData, null, 2)], {
            type: &quot;application/json&quot;,
          });
          const url = URL.createObjectURL(blob);

          // Buat link download
          const a = document.createElement(&quot;a&quot;);
          a.href = url;
          a.download = `seru-tapi-miskin-profile-${profileData.username}.json`;
          a.click();

          // Bersihkan
          URL.revokeObjectURL(url);
        } catch (error) {
          console.error(&quot;Gagal export profil&quot;, error);
          alert(&quot;Gagal export profil&quot;);
        }
      }

      // Fungsi Import Profil
      document
        .getElementById(&quot;import-profile&quot;)
        .addEventListener(&quot;change&quot;, async (event) =&gt; {
          const file = event.target.files[0];
          if (!file) return;

          try {
            const reader = new FileReader();
            reader.onload = async (e) =&gt; {
              try {
                const profileData = JSON.parse(e.target.result);

                // Validasi data
                if (!profileData.username) {
                  alert(&quot;File profil tidak valid&quot;);
                  return;
                }

                // Simpan data
                await localforage.setItem(&quot;username&quot;, profileData.username);

                // Simpan leaderboard jika ada
                if (profileData.leaderboard) {
                  await localforage.setItem(
                    &quot;leaderboard&quot;,
                    profileData.leaderboard
                  );
                }

                // Simpan foto profil jika ada
                if (profileData.profileImage) {
                  await localforage.setItem(
                    &quot;profileImage&quot;,
                    profileData.profileImage
                  );
                  document.getElementById(&quot;profile-image&quot;).src =
                    profileData.profileImage;
                }

                // Refresh halaman
                alert(&quot;Profil berhasil diimpor!&quot;);
                window.location.reload();
              } catch (parseError) {
                console.error(&quot;Gagal parsing file&quot;, parseError);
                alert(&quot;Gagal membaca file profil&quot;);
              }
            };
            reader.readAsText(file);
          } catch (error) {
            console.error(&quot;Gagal import profil&quot;, error);
            alert(&quot;Gagal import profil&quot;);
          }
        });

      // Fungsi Logout
      function logout() {
        localforage.removeItem(&quot;username&quot;).then(() =&gt; {
          window.location.href = &quot;index.html&quot;;
        });
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
