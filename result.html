<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
    rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ²</text></svg>"
  />
    <title>Hasil Quiz - Seru Tapi Miskin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  </head>
  <body
    class="bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 min-h-screen flex items-center justify-center"
  >
    <nav
      class="fixed top-0 left-0 right-0 z-50 bg-white/20 backdrop-blur-md shadow-lg"
    >
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-4">
          <a
            href="index.html"
            class="text-2xl font-bold text-white drop-shadow-lg hover:text-purple-200 transition-colors duration-300"
          >
            Seru Tapi Miskin
          </a>
        </div>

        <div class="flex items-center space-x-6">
          <div class="hidden md:flex space-x-4">
            <a
              href="quiz.html"
              class="text-white hover:text-purple-200 transition-colors duration-300 flex items-center space-x-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="{2}"
                  d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              <span>Quiz</span>
            </a>
            <a
              href="leaderboard.html"
              class="text-white hover:text-purple-200 transition-colors duration-300 flex items-center space-x-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="{2}"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
              <span>Peringkat</span>
            </a>
          </div>

          <div class="flex items-center space-x-4">
            <a
              href="profile.html"
              class="text-white hover:text-purple-200 transition-all duration-300 transform hover:scale-110"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="{2}"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
            </a>
            <button
              onclick="logout()"
              class="text-white hover:text-red-300 transition-all duration-300 transform hover:scale-110"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="{2}"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </nav>
    <div
      class="pt-20 bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center"
    >
    <div class="pt-20 bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center">
      <h1 class="text-3xl font-bold mb-4 text-purple-600">Seru Tapi Miskin</h1>
  
      <div id="result-section" class="space-y-6">
          <div class="bg-purple-100 p-6 rounded-lg">
              <h2 class="text-2xl font-semibold text-purple-700">Skormu</h2>
              <p id="final-score" class="text-5xl font-bold text-purple-800 mt-2"></p>
          </div>
  
          <div id="result-message" class="text-lg text-gray-700 mt-4 text-center"></div>
  
          <div class="space-y-4">
              <button
                  onclick="shareResult()"
                  class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg hover:scale-105 transform transition"
              >
                  Bagikan Hasilmu
              </button>
              <button
                  onclick="window.location.href='index.html'"
                  class="w-full bg-gray-200 text-purple-600 py-3 rounded-lg hover:bg-gray-300"
              >
                  Kembali ke Beranda
              </button>
          </div>
      </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const score = parseInt(urlParams.get("score"));
        const totalQuestions = parseInt(urlParams.get("totalQuestions"));
        const totalScore = parseInt(urlParams.get("totalScore"));

        document.getElementById("final-score").innerText = `${score} / ${totalQuestions}`;

        // Pesan berdasarkan skor
        const resultMessage = document.getElementById("result-message");
        if (score === totalQuestions) {
            resultMessage.innerHTML = `
                <p class="text-green-600 font-bold">ğŸ† Sempurna! Kamu Jenius!</p>
                <p class="text-sm text-gray-600 mt-2">Kerja keras membayar!</p>
            `;
        } else if (score > 0) {
            resultMessage.innerHTML = `
                <p class="text-yellow-600 font-bold">ğŸ‘ Lumayan! Masih Bisa Diperbaiki</p>
                <p class="text-sm text-gray-600 mt-2">Terus belajar ya!</p>
            `;
        } else {
            resultMessage.innerHTML = `
                <p class="text-red-600 font-bold">ğŸ˜… Waduh, Masih Kurang Nih</p>
                <p class="text-sm text-gray-600 mt-2">Jangan menyerah!</p>
            `;
        }

        // Simpan skor ke leaderboard
        await saveScoreToLeaderboard(score, totalQuestions, totalScore);
    });

    // Fungsi untuk menyimpan skor ke leaderboard
    async function saveScoreToLeaderboard(score, totalQuestions, totalScore) {
    try {
        // Ambil username dari local storage
        const username = await localforage.getItem("username");

        // Ambil foto profil dari local storage
        const profileImage = await localforage.getItem("profileImage") || 
            'https://via.placeholder.com/50?text=Profil';

        // Ambil leaderboard yang sudah ada
        let leaderboard = (await localforage.getItem("leaderboard")) || [];

        // Tambahkan entri baru
        leaderboard.push({
            name: username || "Pemain Misterius",
            score: score,
            totalQuestions: totalQuestions,
            totalScore: totalScore,
            date: new Date().toLocaleDateString(),
            profileImage: profileImage
        });

        // Urutkan dari skor tertinggi
        leaderboard.sort((a, b) => b.totalScore - a.totalScore);

        // Batasi 10 skor teratas
        leaderboard = leaderboard.slice(0, 10);

        // Simpan kembali
        await localforage.setItem("leaderboard", leaderboard);
    } catch (error) {
        console.error("Gagal menyimpan skor", error);
    }
}

    // Fungsi share
    function shareResult() {
        const urlParams = new URLSearchParams(window.location.search);
        const score = parseInt(urlParams.get("score"));
        const totalQuestions = parseInt(urlParams.get("totalQuestions"));
        
        const username = localStorage.getItem("username");
        const shareText = `${username} dapat skor ${score}/${totalQuestions} di quiz "Seru Tapi Miskin"! Cobain juga guys! ğŸ¤“`;

        if (navigator.share) {
            navigator.share({
                title: "Hasil Quizku",
                text: shareText,
            }).catch(console.error);
        } else {
            // Fallback untuk browser yang tidak support Web Share API
            alert(shareText);
        }
    }

    // Untuk logout
    function logout() {
        localforage.removeItem("username").then(() => {
            window.location.href = "index.html";
        });
    }
</script>
  </body>
</html>
